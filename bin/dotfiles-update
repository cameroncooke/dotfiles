#!/bin/sh
#
# dotfiles-update
#
# `dotfiles-update` handles installation, updates, things like that. Run it periodically
# to make sure you're on the latest and greatest.
# This was renamed from 'dot' to avoid conflicts with graphviz's dot command.
export ZSH=$HOME/.dotfiles

set -e

# Ensure Homebrew is in PATH
if [[ "$(uname -m)" == "arm64" ]] && [[ -f "/opt/homebrew/bin/brew" ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -f "/usr/local/bin/brew" ]]; then
  eval "$(/usr/local/bin/brew shellenv)"
fi

echo "› Installing/updating Homebrew..."
# Install homebrew
$ZSH/homebrew/install.sh || {
  echo "Failed to install/check Homebrew"
  exit 1
}

# Ensure brew is available
if ! command -v brew &> /dev/null; then
  echo "Homebrew installation failed or not in PATH"
  exit 1
fi

# Upgrade homebrew
echo "› brew update"
brew update || echo "Warning: brew update failed, continuing..."

# Install software
echo "› $ZSH/script/install"
$ZSH/script/install || {
  echo "Warning: Some installations may have failed"
}
